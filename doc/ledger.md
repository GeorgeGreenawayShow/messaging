# Ledger Documentation

The ledger is the main distribution module, it communicates with its MongoDB backend and is responsible 
for holding messages, settings and replies.

## Schemas

### MESSAGE
The message schema is used by all parts of the platform. Every message the platform receives will have the following
JSON schema

{
    "id": "A ledger-defined ID",
    "message": "The message text",
    "author": "A ledger-defined author ID, see 'author' schema"
    "replies": [See replies schema],
    "platform": {},
    "meta": {}
}

### AUTHOR
Every author stored in a separate table. 

{
    "id": "A ledger-defined author ID",
    "name": "Name/number from the platform",
    "nick": "A nickname only used in dashboards"
}

### REPLY
Every reply to a message has the following object.

{
    "id": "Reply ID (generated by platform module)",
    "text": "The reply text",
    "status": "pending/sent/failed"
}

### META
Some platforms may wish to add meta to the message, this isn't standardized and is transparent to the ledger.
One example of the metadata would be twitter. A thread ID could be in the meta so the twitter module can respond
directly to the original message instead of making a new Tweet.

META is entirely optional.

## HTTP API (messages)

### GET messages (/api/messages?limit=x)
Returns all messages in the platform, or limited to x.

[message schema]

> 200 OK

### GET message (/api/message/:id)
Returns a JSON payload of the message (see message schema)

> 200 OK
> 404 NOT FOUND

### DEL message (/api/message/:id)
Deletes a message from the database

> 201 NO CONTENT
> 404 NOT FOUND

## HTTP API (authors)

### GET authors (/api/authors?limit=x)
Returns all authors in the platform, or limited to x.

[Author schema]

> 200 OK

### GET author (/api/author/:id)
Returns the authors schema

> 200 OK
> 404 NOT FOUND

### PATCH author (/api/author/:id)
Allows modification to the nickname of the author

{
    "nick": "Test nick"
}

> 201 NO CONTENT
> 404 NOT FOUND

### DEL author (/api/author/:id)
Delete an author

> 201 NO CONTENT
> 404 NOT FOUND